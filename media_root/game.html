<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>FooxBall</title>
</head>

<body>
  <canvas id="canvas"></canvas>
</body>
<script>
  // constants
  const WIDTH = 1000;
  const HEIGHT = 500;
  const PITCH_COLOR = '#003300'
  const PITCH_LINE_COLOR = '#AAAAAA'
  const PITCH_LINE_WIDTH = 5;
  const WALL_HIT_SPEED_MODIFIER = 0.8;
  const RESISTANCES = 0.99;

  // classes
  class Ball {
    constructor() {
      this.x = 200;
      this.y = 200;
      this.speed = 4;
      this.angle = 225; // degrees [0; 360)
      this.xSpeed = 0;
      this.ySpeed = 0;
      this.calculateSpeeds();
      this.radius = 15;
      this.color = '#FFFFFF'
    }

    calculateSpeeds() {
      this.xSpeed = this.speed * Math.cos(Math.PI * (this.angle / 180));
      this.ySpeed = this.speed * Math.sin(Math.PI * (this.angle / 180));
    }

    move() {
      let newX = this.x + this.xSpeed;
      let newY = this.y + this.ySpeed;

      if (newX - this.radius < 0) { // left wall collision
        let hitAngle = 0;
        if (this.angle > 180) {
          hitAngle = 270 - this.angle;
          this.angle += 2 * hitAngle;
        } else {
          hitAngle = this.angle - 90;
          this.angle -= 2 * hitAngle;
        }

        this.speed *= WALL_HIT_SPEED_MODIFIER;
        this.calculateSpeeds();

      } else if (newX + this.radius > WIDTH) { // rigth wall collision
        let hitAngle = 0;
        if (this.angle < 90) {
          hitAngle = 90 - this.angle;
          this.angle = 90 + hitAngle;
        } else {
          hitAngle = this.angle - 270;
          this.angle -= 2 * hitAngle;
        }

        this.speed *= WALL_HIT_SPEED_MODIFIER;
        this.calculateSpeeds();

      } else if (newY - this.radius < 0) { // top wall collision
        let hitAngle = 0;
        if (this.angle < 270) {
          hitAngle = this.angle - 180;
          this.angle = 180 - hitAngle;
        } else {
          hitAngle = 360 - this.angle;
          this.angle = hitAngle;
        }

        this.speed *= WALL_HIT_SPEED_MODIFIER;
        this.calculateSpeeds();
        
      } else if (newY + this.radius > HEIGHT) { // bottom wall collision
        let hitAngle = 0;
        if (this.angle < 90) {
          hitAngle = this.angle;
          this.angle = 360 - hitAngle;
        } else {
          hitAngle = 180 - this.angle;
          this.angle = 180 + hitAngle;
        }

        this.speed *= WALL_HIT_SPEED_MODIFIER;
        this.calculateSpeeds();
        
      } else {
        this.x = newX;
        this.y = newY;
      }

      this.speed *= RESISTANCES;
      this.xSpeed *= RESISTANCES;
      this.ySpeed *= RESISTANCES;
    }

    draw(ctx) {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI, true);
      ctx.closePath();
      ctx.fill();
    }
  
    randomize() {
      this.speed = 6;
      this.angle = Math.random() * 360;
      this.calculateSpeeds();
    }
  }

  // initialization
  var ctx = document.getElementById('canvas');
  ctx.setAttribute('width', WIDTH)
  ctx.setAttribute('height', HEIGHT)
  var ctx = ctx.getContext('2d');

  ball = new Ball();

  // logic
  function calc() {
    ball.move();
  }

  function drawPitch() {
    // green field
    ctx.fillStyle = PITCH_COLOR;
    ctx.fillRect(0, 0, WIDTH, HEIGHT);

    // set styles for lines
    ctx.lineWidth = PITCH_LINE_WIDTH;
    ctx.fillStyle = PITCH_LINE_COLOR
    ctx.strokeStyle = PITCH_LINE_COLOR;
    const halfW = WIDTH / 2;
    const halfH = HEIGHT / 2;

    // boundaries
    ctx.strokeRect(0, 0, WIDTH, HEIGHT);

    ctx.moveTo(halfW, halfH);

    // middle point
    ctx.beginPath();
    ctx.arc(halfW, halfH, 10, 0, 2 * Math.PI);
    ctx.closePath();
    ctx.fill();

    // middle circle
    ctx.beginPath();
    ctx.arc(halfW, halfH, halfH / 2, 0, 2 * Math.PI);
    ctx.closePath();
    ctx.stroke();

    // middle vertical lines
    ctx.beginPath()
    ctx.moveTo(halfW, 0);
    ctx.lineTo(halfW, HEIGHT);
    ctx.stroke()

    ctx.lineWidth = 1;
  }

  function draw() {
    drawPitch();
    ball.draw(ctx);
  }

  // game loop
  const loop = () => {
    calc();
    draw();
    requestAnimationFrame(loop);
  }

  // events
  document.addEventListener('keydown', (event) => {
    let keyName = event.key;

    if (keyName == 'Spacebar' || keyName == ' ') {
      ball.randomize();
    }
  });

  // start
  requestAnimationFrame(loop);

</script>

</html>